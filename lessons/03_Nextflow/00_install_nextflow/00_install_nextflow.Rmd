---
title: "00_MAC_install_nextflow"
author: "JR"
date: "2023-12-18"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Goal: to install nextflow on super computer and locally on mac or PC (below)
# Youtube video for this class here:
https://youtu.be/vTkoLFra5Lc?si=2fNQNl9LT0tXc-6H


############################
Background and significance
############################

Nextflow is a task management program that will do a bunch of work for us !
It makes a "container" (singularity or docker) that is empty. Then it will 
install all the software you need in that container in the order it's needed - Woah !

This in part due to NF_CORE (see link below) that are pre-build genomics pipelines.
AMAZINGLY they have a pipeline for almost every analysis you could think of. Just imagine
if you had to install each step in the pipeline (ooofda) that would be a ton of work. So 
thanks to Nextflow managing all the tasks in the pipeline and NF_CORE for organizing the 
pipeline we save soooo much time !

# More on nextflow:
https://www.nextflow.io/


# More on NF_CORE:
https://nf-co.re/

# Importantly: NF_CORE / NEXTFLOW have version tracking and QC analysis for each step !
THis is huge !! With out this you would have to install dozens of programs and keep track of 
which version you used (results can change depending on version). Even better, NF_CORE has figured
out which data you might want to see right away and makes nice figures so you can determine the quality 
of your data, which samples are more similar and much much more - #WOW# We will check out all this in
just a few classes, but in the meantime we need to install NEXTFLOW.

#############################
Game plan
#############################

# First we will install nextflow on Fiji. 
Nextflow is a "language" so we also 
need to tell Fiji where to look for this language so it can speak it when 
called to do so. This is in the $PATH.

The $PATH is essentially where your computer will look for commands and languages.
For example we have used unix commands in a bash application (sesssion) and the
$PATH had to know where to look for them. 

In short, the $PATH looks up where any language is installed (nextflow, python anything) -
So whenever you install a new language always think is it in my $PATH. One easy way around this 
is to make a folder where all your installs go and then link that folder in your $PATH.

Ok first things first let's install nextflow (for free) on Fiji - then we will connect to $PATH

#############################
(1) Install Nextflow on Fiji
#############################

# Step 1: module load
Nextflow also depends on java and requires version 11 or higher. We have worked with BioFrontiers 
IT (BIT) team to be able to use the latest version of Java 21 so we can run nextflow properly.

# IF YOU DON'T MODULE LOAD Java 21, NEXTFLOW won't run :)

```{bash}
# module load Java 21 from anywhere on Fiji
# This makes the shell you are on have it but goes away if you close it !
# So you have to do this everytime you run Nextflow

module load openjdk/21.0.1
```

# Nice we have Java 21 running !

Now we need to install - easiest install ever :)

```{bash}
# we want to install in a bin dir
cd ~/
ls # you probably don't have a bin folder so let's make one

makdir bin
cd bin

# Now to install
wget -qO- https://get.nextflow.io | bash
# or
curl -s https://get.nextflow.io | bash

# let's make sure it's installed
nextflow -version

```

# Awesome you have nextflow running in this session
But now we want to add this to your $path and a .bash_profile doc.
This way you can call nextflow from anywhere and your $PATH
will remember for every session moving forward.

```{bash}
# Making .bash_profile (place fiji looks to use languages upon initiating session)
cd ~/

nano .bash_profile

# past in this information to your bin directory
export PATH="$PATH:/Users/<IDENTIKEY>/bin

# or do a pwd from your bin directory

# Exit nano with ctrl-x and y to save.

```

Or we can add this directory directly to our path using bash:
```{bash}

export PATH="$( echo $PATH| tr : '\n' |grep -v /Users/jori2700/bin | paste -s -d: )"
```

# Nice we have nextflow installed to be sure close your session
Open a new session in new terminal shell
Then test if $PATH finds your install
```{bash}

nextflow -version
```

# If it pops up your all set !



###########################
MAC OSX install Nextflow
###########################
## Installing nextflow locally on a mac (similar for PC)

#1: First we need to determine if you have a JAVA version between 11-21
If you aren't sure you can download it here for free:

https://www.oracle.com/java/technologies/downloads/
I chose this one: Install Java 21 (DMG) for MacOS
Follow instructions in the "disk image" or .DMG downloaded

# ALSO install instruction for JAVA on PC/Linux and OSX here:
https://docs.oracle.com/en/java/javase/21/install/overview-jdk-installation.html#GUID-8677A77F-231A-40F7-98B9-1FD0B48C346A

# Cool now we have java 21 !

#2: Let's get Nextflow installed in our bin directory

Find a place you want to make a "bin" folder that has
open permissions so you don't need a password to change it.

For MacOS the main directory is /Users/<computer_name>

I am going to install nextflow in: Users/rinnadmin

# Let's install Nextflow Locally MacOS!
```{bash installing nextflow}

cd Users/<your folder>

# make a bin directory
mkdir bin

# move into bin folder
cd bin

#install nextflow
wget -qO- https://get.nextflow.io | bash
# or
curl -s https://get.nextflow.io | bash

# NOTE: curl and wget are bash commands to go grab stuff from websites
# MORE INFO on variations of nextflow installs if you want differnet versions etc
https://www.nextflow.io/docs/latest/getstarted.html

```

# Finding the $PATH
Awesome we now have nextflow installed - and probably a new JAVA :)
Yet we need to have your computer know where to speak nextflow
$PATH tells your computer where to look for languages and commands

So all we need to do is add nextflow to the $PATH

# Adding nextflow to the $PATH
```{bash adding nextflow to our $PATH}

#let's see what is in our $PATH
echo $PATH

# hmmm : seperated data - let's make that easier to read with "tr"
echo $PATH | tr ":" "\n"
# Nice much easier to see all the places the $PATH leads

# Now we need to use a bash "text editor" nano to add the path to $PATH
# sudo just gives us permissions to do so - you will need to type in pswd
sudo nano /etc/paths.d/nextflow

# now add the nextflow file path to $PATH
# type in :
/Users/rinnadmin/bin
# or 
/Users/<folder_you_chose>/bin

# let's see what changed
echo $PATH | tr ":" "\n"

# Now just quit the session and open new terminal and type:
nextflow -version 

# You should get the version number - if not .. it's not installed

```

# More helpful info for understanding $PATH on a Mac
https://pimylifeup.com/macos-path-environment-variable/#:~:text=To%20temporarily%20set%20the%20path%20environment%20variable%20on,of%20the%20line%2C%20we%20reference%20%E2%80%9C%20%24PATH%20%E2%80%9C.




